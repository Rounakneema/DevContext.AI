# API Contract Definition - Checklist

## Overview
This checklist ensures both Person 1 (Backend) and Person 2 (Frontend) agree on all API specifications before starting parallel development.

## âœ… Completed Files

- [x] `docs/api-contract.yaml` - OpenAPI 3.0 specification
- [x] `docs/websocket-protocol.md` - WebSocket message formats
- [x] `backend/shared/types.ts` - Shared TypeScript interfaces
- [x] `docs/mock-api-responses.json` - Mock data for frontend development

## ðŸ“‹ Review Checklist (Do Together)

### 1. REST API Endpoints Review

Go through each endpoint in `api-contract.yaml` and verify:

- [ ] **POST /analyze**
  - Request body structure makes sense
  - Response includes all needed fields
  - Error responses cover all cases
  
- [ ] **GET /analysis/{id}/status**
  - Status values are clear
  - Progress calculation is understood
  - Polling frequency agreed upon (recommend: every 2 seconds)

- [ ] **GET /analysis/{id}**
  - Response structure is complete
  - All three stages (projectReview, intelligenceReport, interviewSimulation) defined
  - Nested objects are clear

- [ ] **POST /interview/{id}/answer**
  - Answer submission format is simple
  - Evaluation response is comprehensive
  - Timing expectations clear (< 10 seconds)

- [ ] **GET /analysis/history**
  - Pagination parameters agreed
  - Summary fields sufficient for UI

- [ ] **DELETE /analysis/{id}**
  - Deletion behavior understood
  - Cascade deletion of related data confirmed

- [ ] **POST /export/{id}**
  - Export formats (PDF, Markdown) confirmed
  - Response format (binary vs URL) decided

### 2. WebSocket Protocol Review

Review `websocket-protocol.md` and verify:

- [ ] **Connection & Authentication**
  - Token passing method agreed (query string)
  - Connection acknowledgment message understood

- [ ] **Client â†’ Server Messages**
  - Subscribe/unsubscribe actions clear
  - Interview actions (start, submit, pause, resume) defined
  - Message format consistent

- [ ] **Server â†’ Client Messages**
  - Progress update frequency agreed (every 5 seconds or on change)
  - Stage completion notifications clear
  - Interview question/evaluation flow understood
  - Error message format consistent

- [ ] **Reconnection Strategy**
  - Exponential backoff parameters agreed
  - Maximum reconnection attempts decided
  - Message queuing during disconnection discussed

### 3. Shared Types Review

Review `backend/shared/types.ts` and verify:

- [ ] **All interfaces match OpenAPI spec**
  - No mismatches between YAML and TypeScript
  - Field names are identical
  - Optional fields marked correctly

- [ ] **Type completeness**
  - All request types defined
  - All response types defined
  - All nested objects defined
  - WebSocket message types included

- [ ] **Validation helpers**
  - `isValidRepositoryUrl()` logic agreed
  - `isValidAnalysisId()` logic agreed
  - Additional validators needed?

### 4. Mock Data Review

Review `docs/mock-api-responses.json` and verify:

- [ ] **Mock responses are realistic**
  - Data structure matches types
  - Values are representative
  - Edge cases included (errors, empty states)

- [ ] **Frontend can start development**
  - Person 2 can build UI with mock data
  - All user flows covered
  - Error states represented

### 5. Error Handling Agreement

- [ ] **HTTP Status Codes**
  - 200: Success
  - 400: Bad Request (validation errors)
  - 401: Unauthorized (invalid token)
  - 404: Not Found (analysis doesn't exist)
  - 429: Rate Limit Exceeded
  - 500: Internal Server Error

- [ ] **Error Response Format**
  ```typescript
  {
    error: string;      // Error code
    message: string;    // Human-readable message
    statusCode: number; // HTTP status
    details?: object;   // Additional context
  }
  ```

- [ ] **Error Messages**
  - Messages are user-friendly
  - Technical details in `details` field
  - Consistent error codes agreed

### 6. Authentication & Authorization

- [ ] **Cognito Integration**
  - JWT token format understood
  - Token expiration handling agreed (refresh before expiry)
  - Token passing method: `Authorization: Bearer <token>`

- [ ] **Authorization Rules**
  - Users can only access their own analyses
  - Admin access not needed for MVP
  - Rate limiting per user (10 analyses/day)

### 7. Data Validation Rules

- [ ] **Repository URL**
  - Must be valid GitHub URL
  - Format: `https://github.com/{owner}/{repo}`
  - No trailing slashes

- [ ] **GitHub Token**
  - Required only for private repos
  - Format: `ghp_` prefix
  - Validated on backend

- [ ] **Analysis ID**
  - UUID v4 format
  - Generated by backend
  - Immutable

- [ ] **Answer Text**
  - Minimum length: 50 characters
  - Maximum length: 5000 characters
  - No HTML allowed

### 8. Performance Expectations

- [ ] **Response Times**
  - POST /analyze: < 5 seconds (just initiation)
  - GET /analysis/{id}/status: < 1 second
  - GET /analysis/{id}: < 2 seconds
  - POST /interview/{id}/answer: < 10 seconds
  - WebSocket messages: < 500ms latency

- [ ] **Stage Completion Times**
  - Stage 1 (Project Review): < 30 seconds
  - Stage 2 (Intelligence Report): < 60 seconds
  - Stage 3 (Interview Simulation): < 30 seconds
  - Total: < 90 seconds for full analysis

- [ ] **Polling vs WebSocket**
  - Use WebSocket for real-time updates (preferred)
  - Fallback to polling if WebSocket fails
  - Polling interval: 2 seconds

### 9. Data Persistence

- [ ] **Analysis Retention**
  - Analyses stored for 90 days
  - Automatic deletion after 90 days
  - User can delete anytime

- [ ] **Cache Strategy**
  - Repository cache: 24 hours
  - Analysis results: 90 days
  - No caching of interview answers

### 10. Testing Strategy

- [ ] **API Testing**
  - Person 1 provides Postman collection
  - Person 2 tests with mock server first
  - Integration testing after Week 2

- [ ] **WebSocket Testing**
  - Person 1 provides mock WebSocket server
  - Person 2 tests connection and messages
  - Load testing for concurrent connections

## ðŸ”§ Implementation Agreements

### Person 1 (Backend) Commitments

- [ ] Implement all endpoints as specified
- [ ] Return exact response structures from types.ts
- [ ] Provide mock API server or Postman collection by end of Week 1
- [ ] Deploy to dev environment by end of Week 2
- [ ] Document any deviations from spec immediately

### Person 2 (Frontend) Commitments

- [ ] Use shared types from backend/shared/types.ts
- [ ] Handle all error cases gracefully
- [ ] Implement loading states for all async operations
- [ ] Test with mock data first, then integrate real API
- [ ] Report any API issues or needed changes immediately

## ðŸ“ Change Management

If either person needs to change the API contract:

1. **Discuss in Slack/Discord** - Don't make unilateral changes
2. **Update all documents** - YAML, types.ts, mock data, protocol docs
3. **Notify the other person** - Explain why change is needed
4. **Version the change** - Add comment with date and reason
5. **Test integration** - Verify change doesn't break existing code

## âœ… Sign-off

Once both team members have reviewed everything:

- [ ] **Person 1 (Backend)**: I agree to implement this API contract
  - Name: ________________
  - Date: ________________

- [ ] **Person 2 (Frontend)**: I agree to build against this API contract
  - Name: ________________
  - Date: ________________

## ðŸš€ Next Steps After Sign-off

1. **Person 1**: Start building AWS infrastructure and Lambda functions
2. **Person 2**: Start building React app with mock data
3. **Both**: Daily standups to sync progress
4. **Week 2**: Integration testing with real API
5. **Week 4**: End-to-end testing and demo prep

---

**Remember**: This contract is your "handshake" - stick to it, and you'll avoid integration headaches later!
